<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>미래의 하루 | thisdive</title>

  <!-- 단일 파일 데모용 CSP (배포 시 app.css/app.js 분리 + 'unsafe-inline' 제거 권장) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    img-src 'self' data:; 
    style-src 'self' 'unsafe-inline';
    script-src 'self' 'unsafe-inline';
    font-src 'self';
    connect-src 'self';
    frame-ancestors 'none';
    base-uri 'self';
    upgrade-insecure-requests
  ">
  <meta name="color-scheme" content="light" />
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <style>
    :root{
      /* 지윤 무드 팔레트 */
      --bg:#f7f3ed;        /* 전체 배경 연베이지 */
      --card:#ffffff;      /* 카드 배경 */
      --fg:#2a3249;        /* 네이비 텍스트 */
      --muted:#6b7280;     /* 보조 텍스트 */
      --rose-50:#fbf2f0;   /* 매우 연한 로즈 */
      --rose-100:#f4e6e2;  /* 연 로즈 */
      --rose-300:#d7a8b5;  /* 중간 로즈 */
      --beige-200:#ece6df; /* 라인 */
      --beige-300:#e5ddd3; /* hover */
      --ok:#2a7a4b;        /* 확인 색 */
      --wrap:560px;        /* ◀ 카드 너비 확 줄임 (기존 980px → 560px) */
      --r-xl:22px; --r-md:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: system-ui, -apple-system, "Pretendard", "Apple SD Gothic Neo", "Malgun Gothic", "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* 헤더 */
    .header{position:sticky; top:0; z-index:10; background:var(--bg); border-bottom:1px solid var(--beige-200)}
    .header .inner{max-width:var(--wrap); margin:0 auto; padding:14px 22px; display:flex; align-items:center; justify-content:center}
    .title{font-weight:700}

    /* 레이아웃 */
    .wrap{display:grid; place-items:center; padding:22px}
    .card{width:100%; max-width:var(--wrap); background:var(--card); border:1px solid var(--beige-200); border-radius:var(--r-xl); box-shadow:0 8px 24px rgba(0,0,0,.04); overflow:hidden}
    .card-head{padding:22px 22px 10px; border-bottom:1px solid var(--beige-200)}
    .card-head .subtitle{font-size:14px; color:var(--muted)}
    .card-body{padding:18px 22px}
    .section + .section{margin-top:18px}

    /* 필드 */
    .grid{display:grid; grid-template-columns:1fr; gap:12px} /* ◀ 한 줄 레이아웃 고정 */
    /* @media 제거로 항상 1열 유지 */
    .field{display:flex; flex-direction:column}
    .label{font-size:13px; color:var(--muted); margin-bottom:6px}
    .input, .select{
      width:100%; background:#fff; border:1px solid var(--beige-200); color:var(--fg);
      border-radius:12px; padding:12px 14px; font-size:15px; outline:none;
      transition:border-color .2s ease, box-shadow .2s ease
    }
    .input:focus, .select:focus{border-color:var(--rose-300); box-shadow:0 0 0 3px rgba(215,168,181,.22)}

    /* 연/월/일 한 줄 & 컴팩트 캡슐 */
    .row{display:grid; grid-template-columns:repeat(3, 1fr); gap:8px}
    .row.ymd .input{padding:8px 10px; border-radius:10px; font-size:14px}

    .small{font-size:13px; color:var(--muted)}

    /* 미리보기 */
    .preview{
      padding:14px; background:var(--rose-50); border:1px solid var(--beige-200); border-radius:var(--r-md);
      line-height:1.65
    }
    .preview strong{background:linear-gradient(transparent 58%, var(--rose-100) 0)}

    /* 감각 디테일: 항상 한 줄에 하나 */
    .sense{display:grid; grid-template-columns:1fr; gap:10px}

    /* 시각화 체크 */
    .visualize{display:flex; align-items:center; gap:10px; padding:14px; background:var(--rose-100); border:1px solid var(--beige-200); border-radius:var(--r-md)}
    .visualize input{width:16px; height:16px}

    /* 푸터 */
    .card-foot{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px 22px; border-top:1px solid var(--beige-200); background:#fff}
    .btn{
      appearance:none; border:1px solid var(--beige-200); background:var(--fg); color:#fff;
      padding:12px 18px; border-radius:999px; font-weight:600; font-size:15px; cursor:pointer;
      transition:transform .06s ease, opacity .2s ease
    }
    .btn:hover{opacity:.95}
    .btn:active{transform:translateY(1px)}
    .btn[disabled]{opacity:.45; cursor:not-allowed}
    .btn-secondary{background:#fff; color:var(--fg)}

    /* 토스트 */
    .toast{position:fixed; left:50%; bottom:22px; transform:translateX(-50%); background:#111; color:#fff; padding:12px 16px; border-radius:999px; font-size:14px; box-shadow:0 8px 24px rgba(0,0,0,.18); opacity:0; pointer-events:none; transition:opacity .25s ease}
    .toast.show{opacity:1}

    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <a class="sr-only" href="#main">본문 바로가기</a>
  <header class="header">
    <div class="inner"><div class="title">미래의 하루</div></div>
  </header>

  <main id="main" class="wrap">
    <article class="card" aria-labelledby="h1">
      <div class="card-head">
           <div class="subtitle">미래의 나의 하루는 어떨까요? 내가 원하는 하루를 구체적으로 적고, 1분간 그 장면 속에 머물러 보세요.</div>
      </div>

      <div class="card-body">
        <!-- 날짜/장소/인물/행동 기본 파트 -->
        <section class="section" aria-labelledby="sec-basic">
          <h2 id="sec-basic" class="sr-only">기본 정보</h2>
          <div class="grid">
            <div class="row ymd">
              <div class="field">
                <label class="label" for="year">연도</label>
                <input id="year" class="input" type="number" inputmode="numeric" placeholder="예) 2026" min="2024" max="2100" />
              </div>
              <div class="field">
                <label class="label" for="month">월</label>
                <input id="month" class="input" type="number" inputmode="numeric" placeholder="예) 4" min="1" max="12" />
              </div>
              <div class="field">
                <label class="label" for="day">일</label>
                <input id="day" class="input" type="number" inputmode="numeric" placeholder="예) 15" min="1" max="31" />
              </div>
            </div>
            <div class="field">
              <label class="label" for="place">어디서</label>
              <input id="place" class="input" type="text" placeholder="예) 성수동의 작업실에서" />
            </div>
            <div class="field">
              <label class="label" for="with">누구와</label>
              <input id="with" class="input" type="text" placeholder="예) 좋아하는 동료와 함께" />
            </div>
            <div class="field">
              <label class="label" for="doing">무엇을</label>
              <input id="doing" class="input" type="text" placeholder="예) 즐겁게 작업을 하고 있다" />
            </div>
          </div>
          <div class="small" style="margin-top:6px">예시: 나는 <strong>내년 봄(2026.4)</strong>, <strong>성수동의 작업실에서</strong> <strong>좋아하는 동료와 함께</strong> <strong>즐겁게 작업하고 있다</strong>.</div>
        </section>

        <!-- 감각 디테일(선택) -->
        <section class="section" aria-labelledby="sec-sense">
          <h2 id="sec-sense" class="sr-only">감각 디테일</h2>
          <div class="sense">
            <div class="field">
              <label class="label" for="see">보이는 것(시각)</label>
              <input id="see" class="input" type="text" placeholder="예) 오후 햇살, 페퍼민트 초록, 정리된 책상" />
            </div>
            <div class="field">
              <label class="label" for="hear">들리는 것(청각)</label>
              <input id="hear" class="input" type="text" placeholder="예) 잔잔한 재즈, 키보드 타이핑 소리" />
            </div>
            <div class="field">
              <label class="label" for="feel">느껴지는 것(촉/후/미각)</label>
              <input id="feel" class="input" type="text" placeholder="예) 손끝의 따뜻함, 은은한 커피 향" />
            </div>
          </div>
        </section>

        <!-- 미리보기 1: 장면 문장 -->
        <section class="section" aria-labelledby="sec-preview">
          <h2 id="sec-preview" class="sr-only">미리보기</h2>
          <div class="preview" id="preview">나는 <strong>____년 ____월 ____일</strong>, <strong>____</strong>에서 <strong>____</strong>와 함께 <strong>____</strong>을 하고 있다.</div>
        </section>

        <!-- 미리보기 2: 감각 문장 -->
        <section class="section" aria-labelledby="sec-preview-sense">
          <h2 id="sec-preview-sense" class="sr-only">감각 미리보기</h2>
          <div class="preview" id="preview-sense"><strong>____</strong>이 보이고, <strong>____</strong>이 들리고, <strong>____</strong>이 느껴진다.</div>
        </section>

        <!-- 시각화 체크 -->
        <section class="section" aria-labelledby="sec-visual">
          <h2 id="sec-visual" class="sr-only">시각화 체크</h2>
          <label class="visualize">
            <input type="checkbox" id="visualized" />
            <div>
              <div><strong>눈을 감고 10초간 그 장면을 떠올려 보았어요</strong></div>
              <small>호흡 3번 + 몸의 감각(온도/자세/미세한 표정)까지 느껴보기</small>
            </div>
          </label>
        </section>
      </div>

      <div class="card-foot">
        <div class="small" id="hint">필수 항목(연/월/일/장소/누구/무엇) 입력 시 다음 단계로 이동 가능</div>
        <div style="display:flex; gap:10px">
          <button class="btn btn-secondary" id="btn-clear" type="button">초기화</button>
          <button class="btn" id="btn-next" type="button" disabled>다음 → 목표설정</button>
        </div>
      </div>
    </article>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite">저장되었습니다</div>

  <script>
    const KEY = 'thisdive_affirmation_scenario_v1';

    // refs
    const yearEl = document.getElementById('year');
    const monthEl = document.getElementById('month');
    const dayEl = document.getElementById('day');
    const placeEl = document.getElementById('place');
    const withEl = document.getElementById('with');
    const doingEl = document.getElementById('doing');
    const seeEl = document.getElementById('see');
    const hearEl = document.getElementById('hear');
    const feelEl = document.getElementById('feel');
    const preview = document.getElementById('preview');
    const previewSense = document.getElementById('preview-sense');
    const visualized = document.getElementById('visualized');
    const nextBtn = document.getElementById('btn-next');
    const clearBtn = document.getElementById('btn-clear');
    const hint = document.getElementById('hint');
    const toast = document.getElementById('toast');

    const state = {
      year:'', month:'', day:'', place:'', with:'', doing:'',
      see:'', hear:'', feel:'', visualized:false
    };

    function save(showToast=false){
      try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){}
      if(showToast) flashToast('저장되었습니다');
    }
    function flashToast(msg){
      toast.textContent = msg; toast.classList.add('show');
      setTimeout(()=>toast.classList.remove('show'), 1400);
    }

    function fmt(v){ return (v||'').trim(); }

    function render(){
      const y = fmt(state.year)||'____', m = fmt(state.month)||'__', d = fmt(state.day)||'__';
      const plc = fmt(state.place)||'____';
      const w = fmt(state.with)||'____';
      const act = fmt(state.doing)||'____';
      preview.innerHTML = `나는 <strong>${y}년 ${m}월 ${d}일</strong>, <strong>${plc}</strong>에서 <strong>${w}</strong>와 함께 <strong>${act}</strong>을 하고 있다.`;

      // 감각 미리보기
      const s = fmt(state.see)||'____';
      const h = fmt(state.hear)||'____';
      const f = fmt(state.feel)||'____';
      previewSense.innerHTML = `<strong>${s}</strong>이 보이고, <strong>${h}</strong>이 들리고, <strong>${f}</strong>이 느껴진다.`;

      // 필수 체크
      const ok = fmt(state.year) && fmt(state.month) && fmt(state.day) && fmt(state.place) && fmt(state.with) && fmt(state.doing);
      nextBtn.disabled = !ok;
      hint.textContent = ok ? '좋아요. 이제 목표설정으로 넘어갈 수 있어요.' : '필수 항목(연/월/일/장소/누구/무엇)을 채워주세요.';

      visualized.checked = !!state.visualized;
    }

    function bind(el, key){
      el.addEventListener('input', ()=>{ state[key] = el.value; save(false); render(); });
    }

    [
      [yearEl,'year'], [monthEl,'month'], [dayEl,'day'],
      [placeEl,'place'], [withEl,'with'], [doingEl,'doing'],
      [seeEl,'see'], [hearEl,'hear'], [feelEl,'feel']
    ].forEach(([el,k])=> bind(el,k));

    visualized.addEventListener('change', ()=>{ state.visualized = visualized.checked; save(false); });

    clearBtn.addEventListener('click', ()=>{
      Object.keys(state).forEach(k=> state[k] = (k==='visualized'? false : ''));
      [yearEl,monthEl,dayEl,placeEl,withEl,doingEl,seeEl,hearEl,feelEl].forEach(el=> el.value='');
      save(true); render();
    });

    nextBtn.addEventListener('click', ()=>{
      // 다음 단계로 전달 (예: goal.html)
      try{ sessionStorage.setItem('thisdive_affirmation_scenario_payload', JSON.stringify(state)); }catch(e){}
      flashToast('시나리오가 저장되었어요');
      // TODO: 실제 경로로 이동
      // location.href = 'goal.html';
    });

    // 복원
    (function restore(){
      try{
        const raw = localStorage.getItem(KEY);
        if(raw){
          const data = JSON.parse(raw);
          Object.assign(state, data||{});
          yearEl.value = state.year||''; monthEl.value = state.month||''; dayEl.value = state.day||'';
          placeEl.value = state.place||''; withEl.value = state.with||''; doingEl.value = state.doing||'';
          seeEl.value = state.see||''; hearEl.value = state.hear||''; feelEl.value = state.feel||'';
          visualized.checked = !!state.visualized;
        }
      }catch(e){}
      render();
    })();
  </script>
</body>
</html>
