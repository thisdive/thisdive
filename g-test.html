<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ì˜ ëª°ì… ëª©í‘œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSP ë“± ê¸°ì¡´ ë©”íƒ€ëŠ” ë™ì¼ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src  'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
    img-src    'self' data:;
    font-src   'self' https://fonts.gstatic.com https://fonts.googleapis.com;
    connect-src 'self';
    frame-ancestors 'none';
    base-uri 'self';
    upgrade-insecure-requests
  ">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"
        integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU="
        crossorigin="anonymous">
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap">

  <style>
    :root{
      --bg:#f8f5f0; --card:#fff; --ink:#1f2937; --muted:#6b7280;
      --accent:#0f172a; --chip-bd:#e5e7eb; --chip-bg:#fff;
      --chip-on:#0f172a; --chip-on-ink:#fff;
      --radius:22px;
      --divider:#f0ebe6;         /* í—¤ë”/ê¸°ë³¸ êµ¬ë¶„ì„  */
      --wrap-max: 1160px;
      --border: var(--divider, #ece6df);
      --rose-100:#f4e6e2;
      --rose-300:#d7a8b5;
    }

    /* ===== ë ˆì´ì•„ì›ƒ: í—¤ë”ëŠ” ì „í­ ìƒë‹¨, ì‹œíŠ¸ëŠ” ê·¸ ì•„ë˜ ===== */
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font-family: Pretendard, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      padding:0;
    }
    .page{ display:flex; justify-content:center; padding:28px 12px; }

    /* â”€â”€ í—¤ë”(ìƒë‹¨ ì „í­ + ë°‘ì¤„) â”€â”€ */
    .header{
      position: sticky; top:0; z-index:10;
      background: var(--bg);
      border-bottom: 1px solid var(--border);
    }
    .header .inner{
      max-width: var(--wrap-max);
      margin:0 auto; padding:14px 22px;
      display:flex; align-items:center; justify-content:center; gap:10px; position:relative;
    }
    .back-btn{
      position: absolute; left:16px;
      width:22px; height:22px; border-radius:50%; border:1px solid var(--border);
      background:#fff; color:#bbb; font-size:16px; display:grid; place-items:center; cursor:pointer;
    }
    .back-btn:hover{ background: var(--rose-100); }
    .logo-dot{ width:10px; height:10px; border-radius:9999px; background: var(--rose-300); box-shadow: 0 0 0 6px var(--rose-100); }
    .title{ font-weight:650; }

    /* ì‹œíŠ¸(ì¹´ë“œ) â€” ë„ˆë¹„/ê·¸ë¦¼ì/í…Œë‘ë¦¬(ê¸°ì¡´ ìœ ì§€) */
    .sheet{
      width:100%;
      max-width: clamp(220px, 68vw, 260px);
      background:var(--card);
      border: 1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: 0 3px 10px rgba(23,32,52,.04);
      padding:clamp(20px,4vw,40px);
      margin-top:14px;
    }
    .sheet:hover{ box-shadow: 0 8px 26px rgba(23,32,52,.06); }

    h1{ font-size:clamp(20px,3.2vw,28px); margin:0 0 18px; display:flex; align-items:center; gap:8px; font-weight:700; }
    p.lead{ color:var(--muted); margin:8px 0 18px; }

    .block{ margin-bottom:26px; }
    .block-title{
      font-size:1rem; font-weight:600; margin:0 0 12px; color:var(--ink);
      border-bottom:1px solid var(--divider); padding-bottom:6px;
    }

    /* ==========================================================
       SHEET ì•ˆì—ì„œë§Œ ì •ê°ˆí•˜ê²Œ ì¬ë°°ì¹˜ + ëª¨ë“  í…Œë‘ë¦¬ ë² ì´ì§€ í†µì¼
       ==========================================================*/
    .sheet{ --beige-bd:#e9dcd7; }

    /* ì„¹ì…˜ êµ¬íš */
    .sheet .block{ padding:18px 0; margin:0; border-top:1px solid var(--beige-bd); }
    .sheet .block:first-of-type{ border-top:0; padding-top:0; }
    .sheet .block-title{ border-bottom:1px solid var(--beige-bd); }

    /* ë¦¬ë“œ ë¬¸ë‹¨ ì •ëˆ */
    .sheet .lead{
      margin:10px 0 16px;
      line-height:1.6;
      color:#6f7280;
    }

    /* ì¹© ê·¸ë¦¬ë“œ (ì •ê°ˆ) */
    .sheet .chips{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap:12px;
    }
    .sheet .chip{
      justify-content:center; width:100%;
      padding:12px 14px;
      border:1px solid var(--beige-bd);
      background:#fff; color:var(--ink);
      border-radius:999px; font-weight:600;
    }
    /* ì„ íƒ ì¹©: ë°°ê²½ë§Œ ê°•ì¡°, "í…Œë‘ë¦¬ëŠ” ë² ì´ì§€ ìœ ì§€" */
    .sheet .chip.on{
      background:var(--chip-on); color:var(--chip-on-ink);
      border-color:var(--beige-bd);
    }

    /* ë³„ì  íŒ¨ë„ */
    .sheet .panel{
      border:1px solid var(--beige-bd);
      background:#fff; border-radius:16px; padding:16px;
    }
    .sheet .panel-head{ margin-bottom:12px; }
    .sheet .readout{
      border:1px solid var(--beige-bd);
      background:#fff; color:#6b7280;
      padding:6px 10px; border-radius:999px; font-size:12.5px;
    }
    .sheet .stars{ gap:14px; padding:4px 2px; }
    .sheet .scale-hint{ color:#9aa0a6; font-size:12.5px; margin-top:8px; }

    /* ì…ë ¥ */
    .sheet .goal-input{
      border:1px solid var(--beige-bd);
      background:#fff; border-radius:12px;
      padding:12px 14px; font-size:15px;
    }
    .sheet .goal-input:focus{ outline:none; box-shadow:0 0 0 3px rgba(233,220,215,.45); }

    /* ì‹œíŠ¸ ì•ˆì˜ ê¸°íƒ€ pill/ë²„íŠ¼ ì™¸ê³½ì„ ë„ ë² ì´ì§€ë¡œ */
    .sheet .readout, .sheet .chip, .sheet .panel, .sheet .goal-input{ box-shadow:none; }


/* ===============================
   ì¹´ë“œ ì•ˆ ì¼ì ì„  ì œê±° (ì¹© í…Œë‘ë¦¬ëŠ” ìœ ì§€)
   =============================== */

/* ì„¹ì…˜ êµ¬íšì„  ì œê±° */
.sheet .block {
  border-top: none !important;
}

/* ë¸”ë¡ íƒ€ì´í‹€ ë°‘ì¤„ ì œê±° */
.sheet .block-title {
  border-bottom: none !important;
}

/* íŒ¨ë„, ì¹©, ì…ë ¥ì°½ì€ ê·¸ëŒ€ë¡œ (í…Œë‘ë¦¬ ìœ ì§€) */

/* ì„¹ì…˜ ì œëª©/ë¦¬ë“œë§Œ ê°€ìš´ë° */
.sheet .block-title,
.sheet .lead {
  text-align: center;
}

/* ì¹©(ëª°ì… ìœ í˜•) â†’ ê°€ìš´ë° ë°°ì¹˜ + 2ì—´ ìœ ì§€ */
#catField {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  justify-items: center;   /* ê° ì¹©ì„ ê°€ìš´ë°ë¡œ */
}

/* íŒ¨ë„(ë‚œì´ë„ ì„ íƒ) â†’ ê°€ë¡œí­ ì œí•œ + ê°€ìš´ë° */
.sheet .panel {
  max-width: 280px;
  margin: 0 auto;
  text-align: center;
}

/* ëª©í‘œ ì…ë ¥ì°½ â†’ ê°€ìš´ë° */
.sheet .goal-input {
  display: block;
  margin: 0 auto;
  text-align: center;
  max-width: 280px;
}

  </style>
</head>
<body>

<!-- â–£ ìƒë‹¨ ê³ ì • í—¤ë” -->
<header class="header">
  <div class="inner">
    <button id="backBtn" class="back-btn" aria-label="ë’¤ë¡œê°€ê¸°">â†</button>
    <span class="logo-dot" aria-hidden="true"></span>
    <div class="title">ì˜¤ëŠ˜ì˜ ëª©í‘œ</div>
  </div>
</header>

<!-- â–£ ë³¸ë¬¸(ì‹œíŠ¸) -->
<div class="page">
  <main class="sheet" role="main" aria-labelledby="pageTitle">

    <!-- ìœ í˜• -->
    <section class="block" aria-labelledby="b1">
      <h2 id="b1" class="block-title">ë‚˜ì—ê²Œ í•„ìš”í•œ ëª°ì…</h2>

      <div class="chips" id="catField">
        <label class="chip"><input type="radio" name="cat" value="íšŒë³µ"> ğŸ§˜ íšŒë³µ</label>
        <label class="chip"><input type="radio" name="cat" value="í•™ìŠµ"> ğŸ“š í•™ìŠµ</label>
        <label class="chip"><input type="radio" name="cat" value="ì‹¤í–‰"> ğŸ“ ì‹¤í–‰</label>
        <label class="chip"><input type="radio" name="cat" value="ì •ëˆ"> ğŸ§¹ ì •ëˆ</label>
        <label class="chip"><input type="radio" name="cat" value="ì°½ì˜"> ğŸ¨ ì°½ì˜</label>
      </div>
    </section>

    <!-- ë‚œì´ë„ -->
    <section class="block" aria-labelledby="b2">
      <h2 id="b2" class="block-title">ëª°ì…í•  ëª©í‘œì˜ ë‚œì´ë„</h2>


      <div class="panel" role="group" aria-labelledby="difficultyLabel">
        <div class="panel-head">
          <strong id="difficultyLabel">ë‚œì´ë„ ì„ íƒ</strong>
          <span id="readout" class="readout">ë¯¸ì • (0/5)</span>
        </div>

        <div class="stars" id="starsGroup" aria-label="ë‚œì´ë„ ë³„ì ">
          <input class="sr-radio" type="radio" name="diff" id="d1" value="1">
          <label for="d1" class="star" data-val="1" role="button" aria-label="1ì ">â˜…</label>

          <input class="sr-radio" type="radio" name="diff" id="d2" value="2">
          <label for="d2" class="star" data-val="2" role="button" aria-label="2ì ">â˜…</label>

          <input class="sr-radio" type="radio" name="diff" id="d3" value="3">
          <label for="d3" class="star" data-val="3" role="button" aria-label="3ì ">â˜…</label>

          <input class="sr-radio" type="radio" name="diff" id="d4" value="4">
          <label for="d4" class="star" data-val="4" role="button" aria-label="4ì ">â˜…</label>

          <input class="sr-radio" type="radio" name="diff" id="d5" value="5">
          <label for="d5" class="star" data-val="5" role="button" aria-label="5ì ">â˜…</label>
        </div>

        <div class="scale-hint"><span>ê°€ë³ê²Œ</span><span>ë„ì „</span></div>
      </div>
    </section>

    <!-- ëª©í‘œ -->
    <section class="block" aria-labelledby="b3">
      <h2 id="b3" class="block-title">ì˜¤ëŠ˜ì˜ ëª°ì… ëª©í‘œ</h2>
      <input id="goalInput" class="goal-input" type="text"
             placeholder="ì˜ˆ) ë‚œì´ë„(â˜…â˜…) â€” ë©”ì¼ 20ë¶„ ì •ë¦¬í•˜ê¸° / ì½”ë“œ ë¦¬ë·° 3ê±´ ì²˜ë¦¬" />
    </section>

    <!-- CTA -->
    <div class="actions">
      <button id="startBtn" class="cta" type="button">ëª°ì… ì‹œì‘í•˜ê¸° â†’</button>
    </div>
  </main>
</div>

<script>
  const NS='thisdive';
  const K_P2_CURRENT=`${NS}.p2:current`;
  const K_Q_DATA=`${NS}.q:data`;
  const K_P4_LASTP2=`${NS}.p4:lastP2`;
  const K_P4_LASTQ=`${NS}.p4:lastQ`;
  const K_G_DATA=`${NS}.g:data`;
  const K_SELECTED=`${NS}.selectedEmotion`;

  (function resetIfHash(){
    if(location.hash.replace('#','')==='reset'){
      try{
        sessionStorage.clear();
        localStorage.removeItem(K_P2_CURRENT);
        localStorage.removeItem(K_Q_DATA);
        localStorage.removeItem(K_P4_LASTP2);
        localStorage.removeItem(K_P4_LASTQ);
        localStorage.removeItem(K_G_DATA);
      }catch(e){}
    }
  })();

  const backBtn=document.getElementById('backBtn');
  const catField=document.getElementById('catField');
  const readout=document.getElementById('readout');
  const goalEl=document.getElementById('goalInput');
  const startBtn=document.getElementById('startBtn');
  const starsWrap=document.getElementById('starsGroup');

  const minuteMap={1:10,2:15,3:25,4:40,5:50};
  const diffText={0:'ë¯¸ì •',1:'ê°€ë³ê²Œ',2:'ì‰¬ì›€',3:'ë³´í†µ',4:'ì§‘ì¤‘',5:'ë„ì „'};

  (function compareSnapshotsOnEnter(){
    try{
      const curP2=localStorage.getItem(K_P2_CURRENT)||'';
      const lastP2=localStorage.getItem(K_P4_LASTP2)||'';
      if(curP2!==lastP2) localStorage.removeItem(K_G_DATA);
      localStorage.setItem(K_P4_LASTP2,curP2);

      const curQ=localStorage.getItem(K_Q_DATA)||'';
      localStorage.setItem(K_P4_LASTQ,curQ);
    }catch(e){}
  })();

  (function restore(){
    updateReadout(0);
    try{
      const raw=localStorage.getItem(K_G_DATA);
      if(!raw) return;
      const d=JSON.parse(raw);
      if(d.cat){
        const chip=[...catField.querySelectorAll('label.chip input')].find(i=>i.value===d.cat);
        if(chip){ chip.checked=true; chip.closest('.chip')?.classList.add('on'); }
      }
      if(d.diff){
        const r=document.getElementById('d'+d.diff);
        if(r){ r.checked=true; paintStars(d.diff); updateReadout(d.diff); }
      }
      if(typeof d.goal==='string') goalEl.value=d.goal;
    }catch(e){}
  })();

  catField.addEventListener('click', (e)=>{
    const label=e.target.closest('.chip'); if(!label) return;
    const input=label.querySelector('input[type="radio"]'); if(!input) return;
    input.checked=true;
    catField.querySelectorAll('.chip').forEach(c=>c.classList.remove('on'));
    label.classList.add('on');
    save();
  });

  starsWrap.addEventListener('click', (e)=>{
    const star=e.target.closest('.star'); if(!star) return;
    const val=Number(star.dataset.val);
    const r=document.getElementById('d'+val); if(r){ r.checked=true; }
    paintStars(val); updateReadout(val); save();
  });

  function paintStars(val){
    [...starsWrap.querySelectorAll('.star')].forEach(s=>{
      s.style.color=(Number(s.dataset.val)<=Number(val))?'var(--star-on)':'var(--star-off)';
    });
  }
  function updateReadout(v){
    const val=Number(v)||0;
    const extra=minuteMap[val]?` Â· ${minuteMap[val]}ë¶„`:'';
    readout.textContent=`${diffText[val]} (${val}/5)${extra}`;
  }

  function save(){
    const cat=(catField.querySelector('input:checked')||{}).value||'';
    const diff=Number((document.querySelector('input[name="diff"]:checked')||{}).value||0);
    const goal=goalEl.value||'';
    const data={cat,diff,goal,at:Date.now()};
    try{ localStorage.setItem(K_G_DATA, JSON.stringify(data)); }catch(e){}
  }
  goalEl.addEventListener('input', save);

  startBtn.addEventListener('click',()=>{
    const cat=(catField.querySelector('input:checked')||{}).value||'';
    const goal=(goalEl.value||'').trim();
    try{
      if(!sessionStorage.getItem(K_SELECTED)){
        const p2raw=localStorage.getItem(K_P2_CURRENT);
        if(p2raw){ const obj=JSON.parse(p2raw); if(obj&&obj.value) sessionStorage.setItem(K_SELECTED,obj.value); }
      }
      sessionStorage.setItem(`${NS}.goal`,goal);
      sessionStorage.setItem(`${NS}.cat`,cat);
    }catch(e){}
    location.href=`t-test.html?goal=${encodeURIComponent(goal)}&v=${Date.now()}`;
  });

  backBtn.addEventListener('click',()=>{
    if(document.referrer){ history.back(); return; }
    location.href='q-test.html?v='+Date.now();
  });

  window.addEventListener('pageshow',(e)=>{ if(e.persisted){ /* BFCache ë³µê·€ */ }});
</script>
</body>
</html>
