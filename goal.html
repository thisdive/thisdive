<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¤ëŠ˜ì˜ ëª°ì… ëª©í‘œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CSP ë“± ê¸°ì¡´ ë©”íƒ€ëŠ” ë™ì¼ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline';
    style-src  'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
    img-src    'self' data:;
    font-src   'self' https://fonts.gstatic.com https://fonts.googleapis.com;
    connect-src 'self';
    frame-ancestors 'none';
    base-uri 'self';
    upgrade-insecure-requests
  ">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap">

  <style>
  /* ========================= FONTS (local) ==========================*/
  @font-face{ font-family:'MaruBuri'; src:url('./fonts/MaruBuri-Regular.woff2') format('woff2'); font-weight:400; font-style:normal; font-display:swap; }
  @font-face{ font-family:'MaruBuri'; src:url('./fonts/MaruBuri-Bold.woff2') format('woff2'); font-weight:700; font-style:normal; font-display:swap; }
  @font-face{ font-family:'Pretendard'; src:url('./fonts/Pretendard-Regular.woff2') format('woff2'); font-weight:400; font-style:normal; font-display:swap; }

  :root{
    --bg:#f7f3ee;
    --card:#fff;
    --ink:#1f2937;
    --muted:#6b7280;
    --accent:#0f172a;

    /* ì¹´ë“œ í…Œë‘ë¦¬(ëª¨ë“  ì„  í†µì¼ ìƒ‰) */
    --divider:#f0ebe6;
    --border: var(--divider, #ece6df);

    /* ë¡œì¦ˆ íŒ”ë ˆíŠ¸(ì›ë³¸ í˜ì´ì§€ì™€ ë™ì¼) */
    --rose-50:#fbf5f3;   /* ì°¸ê³ ìš© */
    --rose-100:#f4e6e2;  /* í…Œë‘ë¦¬ */
    --rose-300:#d7a8b5;  /* ë¼ë””ì˜¤ ì  */

    /* ì„ íƒ ìº¡ìŠ ë‚´ë¶€ ë°°ê²½(ì›ë³¸ì²˜ëŸ¼ #faf7f2 ê³ ì •) */
    --chip-on-bg:#faf7f2;
    --chip-on-bd:var(--rose-100);
    --chip-on-ink:var(--ink);

    --radius:22px;
    --wrap-max: 1160px;

    /* ë³„ ìœ„ì ¯ ìƒ‰ìƒ */
    --star-on:#FDE68A;
    --star-off:#F3F4F6;
    --star-hover:#FDE68A;

    /* ë²„íŠ¼ ìƒ‰ */
    --navy:#172034;

    --section-gap:12px;
  }

  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--ink);
    font-family: Pretendard, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    padding:0;
  }

  .page{ display:flex; justify-content:center; padding:8px 12px; }

  /* â”€â”€ í—¤ë” â”€â”€ */
  .header{ position: sticky; top:0; z-index:10; background: var(--bg); border-bottom: 1px solid var(--border); }
  .header .inner{ max-width: var(--wrap-max); margin:0 auto; padding:14px 22px; display:flex; align-items:center; justify-content:center; gap:10px; position:relative; }
  .back-btn{ position: absolute; left:16px; width:22px; height:22px; border-radius:50%; border:1px solid var(--border); background:#fff; color:#bbb; font-size:16px; display:grid; place-items:center; cursor:pointer; }
  .back-btn:hover{ background:#f8f4ef; }
  .logo-dot{ width:10px; height:10px; border-radius:9999px; background: var(--rose-300); box-shadow: 0 0 0 6px var(--rose-100); }
  .title{ font-weight:650; }

  /* ì‹œíŠ¸ */
  .sheet{
    width:100%; max-width: clamp(220px, 68vw, 260px);
    background:var(--card);
    border: 1px solid var(--border);
    border-radius:var(--radius);
    box-shadow: 0 3px 10px rgba(23,32,52,.04);
    padding:clamp(20px,4vw,30px);
    margin:14px 0;
  }
  .sheet:hover{ box-shadow: 0 8px 26px rgba(23,32,52,.06); }

  .block{ margin:0; padding:5px 0; }
  .sheet .block:first-of-type{ padding-top:0; }

  /* ì„¹ì…˜ ì œëª© */
  .sheet .block-title, .sheet .lead { text-align:center; }
  .block-title{ font-size:1rem; font-weight:600; margin: var(--section-gap) 0 var(--section-gap); color:var(--ink); }

  /* ì¹´í…Œê³ ë¦¬ ì¹© (ê¸°ë³¸) */
  .sheet .chips{ display:grid; grid-template-columns: repeat(2,1fr); gap:12px; }
  .sheet .chip{
    justify-content:center; padding:10px 12px;
    border:1px solid var(--border);
    background:#fff; color:var(--muted);
    border-radius:999px; font-weight:600;
    display:inline-flex; align-items:center; gap:8px;
    cursor:pointer; transition:transform .05s ease, box-shadow .15s ease, background .15s ease, color .15s ease, border-color .15s ease;
    white-space:nowrap;
  }

  /* ë¼ë””ì˜¤ ì  (ê¸°ë³¸/ì„ íƒ) â€” ì›ë³¸ í˜ì´ì§€ì™€ ë™ì¼ ë™ì‘ */
  .sheet .chip input{ appearance:none; width:14px; height:14px; border:2px solid var(--border); border-radius:50%; position:relative; }
  .sheet .chip input:checked{ border-color:var(--rose-300); background:var(--rose-300); }
  .sheet .chip input:checked::after{ content:''; position:absolute; inset:4px; background:#fff; border-radius:50%; }

  /* âœ… ì„ íƒëœ ì¹© ìŠ¤íƒ€ì¼ â€” ì²« ì´ë¯¸ì§€ 'ê·¸ëŒ€ë¡œ' ì´ì‹ (ìš°ì„ ìˆœìœ„+!importantë¡œ í™•ì‹¤íˆ ì ìš©) */
  #catField .chip.on{
    background:#faf7f2 !important;      /* í…Œë‘ë¦¬ ë‚´ë¶€ìƒ‰ */
    border-color:#f4e6e2 !important;     /* í…Œë‘ë¦¬ìƒ‰ */
    color:var(--ink) !important;         /* ì˜µì…˜ í…ìŠ¤íŠ¸ìƒ‰ */
    box-shadow:0 6px 16px rgba(23,32,52,.06);
    transform:translateY(-1px);
  }

  /* íŒ¨ë„/ì½ê¸°ê°’/ì…ë ¥ */
  .sheet .panel{ border:1px solid var(--border); background:#fff; border-radius:16px; padding:16px; max-width:280px; margin:0 auto; text-align:center; }
  .sheet .panel-head{ margin-bottom:12px; }
  .readout{ border:1px solid #e5e7eb; background:#f9fafb; color:#6b7280; padding:6px 10px; border-radius:999px; font-size:12.5px; display:inline-block; }

  /* ë³„ ìœ„ì ¯ */
  .stars{ display:inline-flex; flex-direction: row-reverse; gap:6px; user-select:none; padding:4px 2px; }
  .stars input{ position:absolute; opacity:0; pointer-events:none; }
  .stars label{ font-size:28px; line-height:1; cursor:pointer; color:var(--star-off); transition: color .12s ease, transform .08s ease; }
  .stars label:hover, .stars label:hover ~ label{ color:var(--star-hover); }
  .stars input:checked ~ label{ color:var(--star-on); }
  .stars label:active{ transform: scale(.96); }
  .stars input:focus-visible + label{ outline:3px solid rgba(59,130,246,.35); border-radius:6px; outline-offset:2px; }

  /* ì…ë ¥ */
  .sheet .goal-input{
    border:1px solid var(--border); background:#fff; border-radius:12px;
    padding:12px 14px; font-size:15px; display:block; margin:0 auto; text-align:center;
    width:90%; max-width:none;
  }
  .sheet .goal-input:focus{ outline:none; box-shadow:0 0 0 3px rgba(233,220,215,.45); }

  /* ì œëª© í°íŠ¸(í”„ë¦¬í…ë‹¤ë“œ) */
  #b1.block-title,#b2.block-title,#b3.block-title{ font-family:'Pretendard','Noto Sans KR',sans-serif; font-weight:700; }

  /* ì ì„  êµ¬ë¶„ì„  */
  .dotted-sep{ width:100%; height:0; border:0; border-top:1px dashed var(--border); margin:12px 0 1px; }

  /* CTA */
  .cta{ border-top:1px solid var(--border); padding:14px clamp(14px,3vw,26px); background:none; }
  .cta-inner{ max-width: var(--wrap-max); margin: 0 auto; text-align: center; }
  .btn{ font-family:'Pretendard',sans-serif; width:200px; padding:16px 0; background:var(--navy); color:#fff; border:1px solid rgba(23,32,52,.12); border-radius:18px; font-weight:650; letter-spacing:.2px; box-shadow:0 10px 24px rgba(23,32,52,.22); font-size:.9rem; cursor:pointer; }
  .btn:active{ transform:translateY(1px); }
  .btn:focus-visible{ outline:0; box-shadow:0 0 0 6px rgba(215,168,181,.35); }
  @supports (padding: max(0px)){ .cta{ padding-bottom: max(14px, env(safe-area-inset-bottom)); } }

/* =========================
   [FIX] ì¹© ì„ íƒ ì‹œ ë°°ê²½ ìœ ì§€
   - ì¼ë¶€ ë¸Œë¼ìš°ì €/ì›¹ë·°ì—ì„œ ë¼ë””ì˜¤ ì²´í¬ê°€ ìº¡ìŠ ë°°ê²½ì„ ë‹¤ì‹œ í°ìƒ‰ìœ¼ë¡œ ë®ëŠ” í˜„ìƒ ë°©ì§€
   - ë†’ì€ íŠ¹ì´ì„± + !important ë¡œ ê°•ì œ
   ========================= */

/* ì„ íƒ ìƒíƒœ(.on)ì™€ ë¼ë””ì˜¤ê°€ ì²´í¬ëœ ìƒíƒœ ëª¨ë‘ ì»¤ë²„ */
#catField > label.chip.on,
#catField > label.chip:is(:focus, :focus-visible, :active).on,
#catField > label.chip:has(input[type="radio"]:checked) {
  background-color: #faf7f2 !important;   /* ìº¡ìŠ ë°°ê²½ ìœ ì§€ */
  border-color: #f4e6e2 !important;       /* í…Œë‘ë¦¬ */
  color: var(--ink) !important;            /* ê¸€ììƒ‰ */
  box-shadow: 0 6px 16px rgba(23,32,52,.06);
  transform: translateY(-1px);
}

/* ë¼ë””ì˜¤ ì  ìƒ‰ìƒì€ ìœ ì§€ */
#catField > label.chip input[type="radio"]:checked {
  border-color: var(--rose-300) !important;
  background: var(--rose-300) !important;
}

/* í˜¸ë²„/í¬ì»¤ìŠ¤ì—ë„ ë°°ê²½ ì•ˆ ë‚ ì•„ê°€ë„ë¡ ë³´í˜¸ */
#catField > label.chip.on:hover,
#catField > label.chip.on:focus,
#catField > label.chip.on:active {
  background-color: #faf7f2 !important;
}

  </style>
</head>
<body>
  <header class="header">
    <div class="inner">
      <button id="backBtn" class="back-btn" aria-label="ë’¤ë¡œê°€ê¸°">â†</button>
      <span class="logo-dot" aria-hidden="true"></span>
      <div class="title">ì˜¤ëŠ˜ì˜ ëª©í‘œ</div>
    </div>
  </header>

  <div class="page">
    <main class="sheet" role="main" aria-labelledby="pageTitle">
      <!-- ìœ í˜• -->
      <section class="block" aria-labelledby="b1">
        <h2 id="b1" class="block-title">ë‚˜ì—ê²Œ í•„ìš”í•œ ëª°ì…</h2>
        <div class="chips" id="catField">
          <label class="chip"><input type="radio" name="cat" value="íšŒë³µ"> ğŸ§˜ íšŒë³µ</label>
          <label class="chip"><input type="radio" name="cat" value="í•™ìŠµ"> ğŸ“š í•™ìŠµ</label>
          <label class="chip"><input type="radio" name="cat" value="ì‹¤í–‰"> ğŸ“ ì‹¤í–‰</label>
          <label class="chip"><input type="radio" name="cat" value="ì •ëˆ"> ğŸ§¹ ì •ëˆ</label>
          <label class="chip"><input type="radio" name="cat" value="ì°½ì˜"> ğŸ¨ ì°½ì˜</label>
          <label class="chip"><input type="radio" name="cat" value="ì„±ì°°"> âœ¨ ì„±ì°°</label>
        </div>
      </section>

      <div class="dotted-sep" role="separator" aria-hidden="true"></div>

      <!-- ë‚œì´ë„ -->
      <section class="block" aria-labelledby="b2">
        <h2 id="b2" class="block-title">ì˜¤ëŠ˜ ëª©í‘œì˜ ë‚œì´ë„</h2>
        <div class="panel" role="radiogroup" aria-labelledby="difficultyLabel">
          <div class="panel-head">
            <span id="readout" class="readout">ë¯¸ì • (0/5)</span>
          </div>

          <!-- â˜… ë³„ ìœ„ì ¯ -->
          <div class="stars" id="starsGroup">
            <input type="radio" name="difficulty" id="diff-5" value="5" aria-label="5 - ë„ì „" />
            <label for="diff-5" title="5">â˜…</label>
            <input type="radio" name="difficulty" id="diff-4" value="4" aria-label="4 - ì§‘ì¤‘" />
            <label for="diff-4" title="4">â˜…</label>
            <input type="radio" name="difficulty" id="diff-3" value="3" aria-label="3 - ë³´í†µ" />
            <label for="diff-3" title="3">â˜…</label>
            <input type="radio" name="difficulty" id="diff-2" value="2" aria-label="2 - ì‰¬ì›€" />
            <label for="diff-2" title="2">â˜…</label>
            <input type="radio" name="difficulty" id="diff-1" value="1" aria-label="1 - ê°€ë³ê²Œ" />
            <label for="diff-1" title="1">â˜…</label>
          </div>
        </div>
      </section>

      <div class="dotted-sep" role="separator" aria-hidden="true"></div>

      <!-- ëª©í‘œ -->
      <section class="block" aria-labelledby="b3">
        <h2 id="b3" class="block-title">ì˜¤ëŠ˜ì˜ ëª©í‘œ</h2>
        <input id="goalInput" class="goal-input" type="text" placeholder="ì˜ˆ) ì˜ë‹¨ì–´ 10ê°œ ì™¸ìš°ê¸°" />
      </section>
    </main>
  </div>

  <div class="cta">
    <div class="cta-inner">
      <button class="btn" id="nextBtn">ëª°ì… ì‹œì‘í•˜ê¸° â†’</button>
    </div>
  </div>

  <script>
  /* =========================
     ê¸°ë³¸ ìƒìˆ˜/ìš”ì†Œ
     ========================= */
  const NS = 'thisdive';
  const K_G_DATA   = `${NS}.g:data`;
  const K_SELECTED = `${NS}.selectedEmotion`;

  const backBtn   = document.getElementById('backBtn');
  const catField  = document.getElementById('catField');
  const readout   = document.getElementById('readout');
  const goalEl    = document.getElementById('goalInput');
  const nextBtn   = document.getElementById('nextBtn');
  const starsWrap = document.getElementById('starsGroup');

  const minuteMap = {1:10, 2:15, 3:25, 4:40, 5:50};
  const diffText  = {0:'ë¯¸ì •', 1:'ê°€ë³ê²Œ', 2:'ì‰¬ì›€', 3:'ë³´í†µ', 4:'ì§‘ì¤‘', 5:'ë„ì „'};

  // âœ… ë‚œì´ë„ í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ (ê´„í˜¸/ë¶„ ì œê±°)
  function updateReadout(v){
    const val = Number(v) || 0;
    readout.textContent = diffText[val] || 'ë¯¸ì •';
  }

  function currentDiff(){
    const sel = document.querySelector('input[name="difficulty"]:checked');
    return sel ? Number(sel.value) : 0;
  }
  function save(){
    const cat  = (catField.querySelector('input:checked')||{}).value || '';
    const diff = currentDiff();
    const goal = goalEl.value || '';
    const data = {cat, diff, goal, at: Date.now()};
    try{ localStorage.setItem(K_G_DATA, JSON.stringify(data)); }catch(e){}
  }

  /* =========================
     ì¹´í…Œê³ ë¦¬ ì¹©
     ========================= */
  catField.addEventListener('click', (e)=>{
    const label = e.target.closest('.chip');
    if(!label) return;
    const input = label.querySelector('input[type="radio"]');
    if(!input) return;
    input.checked = true;
    catField.querySelectorAll('.chip').forEach(c=> c.classList.remove('on'));
    label.classList.add('on');
    save();
  });

  /* =========================
     [FIX] ë³„ì : ë¼ë²¨ í´ë¦­/í„°ì¹˜ì—ì„œë„ í™•ì‹¤íˆ ë°˜ì‘
     ========================= */
  (function initStars(){
    const radios = [...document.querySelectorAll('#starsGroup input[name="difficulty"]')];
    const labels = [...document.querySelectorAll('#starsGroup label[for]')];

    function setDifficulty(v){
      updateReadout(v);
      save();
    }

    // ë¼ë””ì˜¤ ìì²´ ë³€ê²½ ì‹œ
    radios.forEach(r=>{
      r.addEventListener('change', ()=> setDifficulty(r.value));
    });

    // ë¼ë²¨ í´ë¦­ ì‹œ ê°•ì œë¡œ change ë°œìƒ (ëª¨ë°”ì¼/ì›¹ë·° ì¼ë¶€ ì¼€ì´ìŠ¤ ëŒ€ì‘)
    labels.forEach(l=>{
      l.addEventListener('click', ()=>{
        const id = l.getAttribute('for');
        const el = document.getElementById(id);
        if (el){
          el.checked = true;
          el.dispatchEvent(new Event('change', { bubbles:true })); // readout ê°±ì‹  ë³´ì¥
        }
      });
    });

    // í‚¤ë³´ë“œ ì ‘ê·¼ì„± (ì¢Œìš°/ìƒí•˜)
    radios.forEach(r=>{
      r.addEventListener('keydown', e=>{
        if(e.key==='ArrowLeft' || e.key==='ArrowDown'){
          e.preventDefault();
          const prev = [...radios].reverse().find(x=> +x.value < +r.value);
          if(prev){ prev.checked = true; prev.dispatchEvent(new Event('change', {bubbles:true})); prev.focus(); }
        }
        if(e.key==='ArrowRight' || e.key==='ArrowUp'){
          e.preventDefault();
          const next = [...radios].find(x=> +x.value > +r.value);
          if(next){ next.checked = true; next.dispatchEvent(new Event('change', {bubbles:true})); next.focus(); }
        }
      });
    });

    // í˜ì´ì§€ ì§„ì… ì‹œ í˜„ì¬ ì„ íƒ ë°˜ì˜(ì—†ìœ¼ë©´ 0) â†’ "ë¯¸ì •"ìœ¼ë¡œ ë®ì–´ì¨ì„œ (0/5) ì œê±°
    setDifficulty((document.querySelector('#starsGroup input[name="difficulty"]:checked')||{}).value || 0);
  })();

  /* =========================
     ì…ë ¥ ì €ì¥
     ========================= */
  goalEl.addEventListener('input', save);

  /* =========================
     CTA ì´ë™ (ê¸°ì¡´ íŒŒì¼ëª… ìœ ì§€: t-test.html)
     ========================= */
  nextBtn.addEventListener('click', ()=>{
    const cat  = (catField.querySelector('input:checked')||{}).value || '';
    const goal = (goalEl.value||'').trim();

    try{
      // ì„ íƒ ê°ì •ì€ ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ë‹¤ë£° ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ëª©í‘œ/ì¹´í…Œê³ ë¦¬ë§Œ ì„¸ì…˜ ë³´ê°•
      sessionStorage.setItem(`${NS}.goal`, goal);
      sessionStorage.setItem(`${NS}.cat`,  cat);
    }catch(e){}

    location.href = `t-test.html?goal=${encodeURIComponent(goal)}&v=${Date.now()}`;
  });

  /* =========================
     ë’¤ë¡œê°€ê¸° (ê¸°ì¡´ ìœ ì§€: q-test.html)
     ========================= */
  backBtn.addEventListener('click', ()=>{
    if (document.referrer){ history.back(); return; }
    location.href = 'q-test.html?v=' + Date.now();
  });
  </script>
</body>
</html>
