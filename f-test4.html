<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>미래의 일상 | thisdive</title>
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline';
    script-src 'self' 'unsafe-inline';
    font-src 'self';
    connect-src 'self';
    frame-ancestors 'none';
    base-uri 'self';
    upgrade-insecure-requests
  ">
  <meta name="color-scheme" content="light" />
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <style>
    :root{
      --bg:#f7f3ed;
      --card:#ffffff;
      --fg:#2a3249;
      --muted:#6b7280;
      --rose-50:#fbf2f0;
      --rose-100:#f4e6e2;
      --rose-300:#d7a8b5;
      --beige-200:#ece6df; /* 헤더 하단선과 동일 */
      --beige-300:#e5ddd3;
      --ok:#2a7a4b;
      --wrap:310px;
      --r-xl:22px; --r-md:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: system-ui, -apple-system, "Pretendard", "Apple SD Gothic Neo", "Malgun Gothic", "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* 헤더 */
    .header{position:sticky; top:0; z-index:10; background:var(--bg); border-bottom:1px solid var(--beige-200)}
    .header .inner{max-width:var(--wrap); margin:0 auto; padding:14px 22px; display:flex; align-items:center; justify-content:center}
    .title{font-weight:700}

    /* 원형 도트 */
    .logo-dot{
      width:10px; height:10px; border-radius:9999px;
      background:#d7a8b5;
      box-shadow:0 0 0 6px #f4e6e2;
      margin-right:8px;
    }

    /* 레이아웃 */
    .wrap{display:grid; place-items:center; padding:22px}
    .card{
      width:100%; max-width:var(--wrap);
      background:var(--card);
      border:1px solid var(--beige-200);
      border-radius:var(--r-xl);
      box-shadow:0 8px 24px rgba(0,0,0,.04);
      overflow:hidden;
      margin-bottom:28px;
      position:relative; z-index:0;
    }
    .card-head{padding:22px 22px 10px; border-bottom:1px solid var(--beige-200)}
    .card-head .subtitle{font-size:14px; color:var(--muted)}
    .card-body{padding:18px 22px}
    .section + .section{margin-top:18px}

    /* 필드 */
    .grid{display:grid; grid-template-columns:1fr; gap:12px}
    .field{display:flex; flex-direction:column}
    .label{font-size:13px; color:var(--muted); margin-bottom:6px}
    .input, .select{
      width:100%; background:#fff; border:1px solid var(--beige-200); color:var(--fg);
      border-radius:12px; padding:12px 14px; font-size:15px; outline:none;
      transition:border-color .2s ease, box-shadow .2s ease
    }
    .input:focus, .select:focus{border-color:var(--rose-300); box-shadow:0 0 0 3px rgba(215,168,181,.22)}

    /* 연/월/일 한 줄 */
    .row{display:grid; grid-template-columns:repeat(3, 1fr); gap:8px}
    .row.ymd .input{padding:8px 10px; border-radius:10px; font-size:14px}

    .small{font-size:13px; color:var(--muted)}

    /* 미리보기 */
    .preview{
      padding:14px; background:var(--rose-50); border:1px solid var(--beige-200); border-radius:var(--r-md);
      line-height:1.65
    }
    .preview strong{background:linear-gradient(transparent 58%, var(--rose-100) 0)}

    /* 감각 디테일 */
    .sense{display:grid; grid-template-columns:1fr; gap:10px}

    /* 시각화 체크 */
    .visualize{display:flex; align-items:center; gap:10px; padding:14px; background:var(--rose-100); border:1px solid var(--beige-200); border-radius:var(--r-md)}
    .visualize input{width:16px; height:16px}

    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* 카드 아래 CTA (버튼은 중앙, 선만 풀블리드) */
    .cta{
      padding:16px;
      text-align:center;
      position: relative;
    }
    .cta-inner{ max-width:var(--wrap); margin:0 auto; }
    .cta::before{
      content:"";
      position:absolute;
      top:0;
      left:50%;
      transform:translateX(-50%);
      width:100vw;                       /* 헤더 선과 동일 길이 */
      border-top:1px solid var(--beige-200);
      pointer-events:none;
    }

    /* 버튼 */
    .btn{
      width:200px;
      padding:16px 0;
      background:#172034;
      color:#ffffff;
      border:1px solid rgba(23,32,52,.12);
      border-radius:18px;
      font-weight:650;
      letter-spacing:.2px;
      box-shadow:0 10px 24px rgba(23,32,52,.22);
      font-size:0.9rem;
      cursor:pointer;
    }
    .btn:active{ transform:translateY(1px); }
    .btn:focus-visible{
      outline:0;
      box-shadow:0 0 0 6px rgba(215,168,181,.35);
    }
  </style>
</head>
<body>
  <a class="sr-only" href="#main">본문 바로가기</a>
  <header class="header">
    <div class="inner">
      <span class="logo-dot" aria-hidden="true"></span>
      <div class="title">미래의 하루</div>
    </div>
  </header>

  <main id="main" class="wrap">
    <article class="card" aria-labelledby="h1">
      <div class="card-head">
        <div class="subtitle">미래의 나의 하루는 어떨까요? 내가 원하는 하루를 구체적으로 적고, 1분간 그 장면 속에 머물러 보세요.</div>
      </div>

      <div class="card-body">
        <section class="section" aria-labelledby="sec-basic">
          <h2 id="sec-basic" class="sr-only">기본 정보</h2>
          <div class="grid">
            <div class="row ymd">
              <div class="field"><label class="label" for="year">연도</label><input id="year" class="input" type="number" placeholder="예) 2026" /></div>
              <div class="field"><label class="label" for="month">월</label><input id="month" class="input" type="number" placeholder="예) 4" /></div>
              <div class="field"><label class="label" for="day">일</label><input id="day" class="input" type="number" placeholder="예) 15" /></div>
            </div>
            <div class="field"><label class="label" for="place">어디서</label><input id="place" class="input" type="text" placeholder="예) 성수동의 작업실에서" /></div>
            <div class="field"><label class="label" for="with">누구와</label><input id="with" class="input" type="text" placeholder="예) 좋아하는 동료와 함께" /></div>
            <div class="field"><label class="label" for="doing">무엇을</label><input id="doing" class="input" type="text" placeholder="예) 즐겁게 작업을 하고 있다" /></div>
          </div>
        </section>

        <section class="section" aria-labelledby="sec-sense">
          <h2 id="sec-sense" class="sr-only">감각 디테일</h2>
          <div class="sense">
            <div class="field"><label class="label" for="see">보이는 것(시각)</label><input id="see" class="input" type="text" placeholder="예) 오후 햇살" /></div>
            <div class="field"><label class="label" for="hear">들리는 것(청각)</label><input id="hear" class="input" type="text" placeholder="예) 잔잔한 재즈" /></div>
            <div class="field"><label class="label" for="feel">느껴지는 것(촉/후/미각)</label><input id="feel" class="input" type="text" placeholder="예) 손끝의 따뜻함" /></div>
          </div>
        </section>

        <section class="section" aria-labelledby="sec-preview">
          <h2 id="sec-preview" class="sr-only">미리보기</h2>
          <div class="preview" id="preview">나는 <strong>____년 ____월 ____일</strong>, <strong>____</strong>에서 <strong>____</strong>와 함께 <strong>____</strong>을 하고 있다.</div>
        </section>

        <section class="section" aria-labelledby="sec-preview-sense">
          <h2 id="sec-preview-sense" class="sr-only">감각 미리보기</h2>
          <div class="preview" id="preview-sense">지금 내 눈 앞에는 <strong>____</strong>이 보이고, <br><br>👂🏻 <strong>____</strong>이 들리고, <br><br>✨ <strong>____</strong>이 느껴진다.</div>
        </section>

        <section class="section" aria-labelledby="sec-visual">
          <h2 id="sec-visual" class="sr-only">시각화 체크</h2>
          <label class="visualize">
            <input type="checkbox" id="visualized" />
            <div><strong>눈을 감고 1분간 그 장면을 떠올려 보세요.</strong></div>
          </label>
        </section>
      </div>
    </article>

    <!-- 카드 아래 CTA -->
    <div class="cta">
      <div class="cta-inner">
        <button class="btn" id="btn-next" type="button">다음 → 목표설정</button>
      </div>
    </div>
  </main>

  <script>
    const KEY = 'thisdive_affirmation_scenario_v1';
    const NS = 'thisdive';
    const K_EMO_CUR = `${NS}.p2:current`;
    const K_SCN_LAST_EMO = `${NS}.scenario:lastEmotion`;

    const yearEl = document.getElementById('year');
    const monthEl = document.getElementById('month');
    const dayEl = document.getElementById('day');
    const placeEl = document.getElementById('place');
    const withEl = document.getElementById('with');
    const doingEl = document.getElementById('doing');
    const seeEl = document.getElementById('see');
    const hearEl = document.getElementById('hear');
    const feelEl = document.getElementById('feel');
    const preview = document.getElementById('preview');
    const previewSense = document.getElementById('preview-sense');
    const visualized = document.getElementById('visualized');
    const nextBtn = document.getElementById('btn-next');

    const state = {year:'', month:'', day:'', place:'', with:'', doing:'', see:'', hear:'', feel:'', visualized:false};

    function save(){ try{ localStorage.setItem(KEY, JSON.stringify(state)); }catch(e){} }
    function fmt(v){ return (v||'').trim(); }

    function clearAll() {
      Object.keys(state).forEach(k => state[k] = (k === 'visualized' ? false : ''));
      [yearEl, monthEl, dayEl, placeEl, withEl, doingEl, seeEl, hearEl, feelEl].forEach(el => el.value = '');
      try { localStorage.removeItem(KEY); } catch(e){}
      save();
      render();
    }

    function render(){
      const y = fmt(state.year)||'____', m = fmt(state.month)||'__', d = fmt(state.day)||'__';
      const plc = fmt(state.place)||'____';
      const w = fmt(state.with)||'____';
      const act = fmt(state.doing)||'____';
      preview.innerHTML = `나는 <strong>${y}년 ${m}월 ${d}일</strong>, <strong>${plc}</strong>에서 <strong>${w}</strong>와(과) 함께 <strong>${act}</strong>을 하고 있다.`;

      const s = fmt(state.see)||'____';
      const h = fmt(state.hear)||'____';
      const f = fmt(state.feel)||'____';
      previewSense.innerHTML = `👁️ <strong>${s}</strong>이 보이고, <br><br>👂🏻 <strong>${h}</strong>이 들리고, <br><br>✨ <strong>${f}</strong>이 느껴진다.`;

      nextBtn.disabled = false;
      visualized.checked = !!state.visualized;
    }

    function bind(el, key){ el.addEventListener('input', ()=>{ state[key] = el.value; save(); render(); }); }
    [[yearEl,'year'], [monthEl,'month'], [dayEl,'day'], [placeEl,'place'], [withEl,'with'], [doingEl,'doing'], [seeEl,'see'], [hearEl,'hear'], [feelEl,'feel']]
      .forEach(([el,k])=> bind(el,k));

    visualized.addEventListener('change', ()=>{ state.visualized = visualized.checked; save(); });

    nextBtn.addEventListener('click', ()=>{ 
      try{ sessionStorage.setItem('thisdive_affirmation_scenario_payload', JSON.stringify(state)); }catch(e){} 
      location.href = 'goal.html'; 
    });

    (function restore(){
      try{
        const curEmotion = localStorage.getItem(K_EMO_CUR) || '';
        const lastEmotion = localStorage.getItem(K_SCN_LAST_EMO) || '';
        const sp = new URLSearchParams(location.search);
        const qrReenter = sp.get('qr') === '1' || sp.get('fresh') === '1' || (location.hash || '').includes('reset');
        if ((curEmotion && lastEmotion && curEmotion !== lastEmotion) || qrReenter) {
          clearAll(); localStorage.setItem(K_SCN_LAST_EMO, curEmotion || '');
        } else {
          const raw = localStorage.getItem(KEY);
          if(raw){ Object.assign(state, JSON.parse(raw)||{}); }
          yearEl.value = state.year||''; monthEl.value = state.month||''; dayEl.value = state.day||'';
          placeEl.value = state.place||''; withEl.value = state.with||''; doingEl.value = state.doing||'';
          seeEl.value = state.see||''; hearEl.value = state.hear||''; feelEl.value = state.feel||'';
          visualized.checked = !!state.visualized;
          localStorage.setItem(K_SCN_LAST_EMO, curEmotion || '');
        }
      }catch(e){}
      render();
    })();
  </script>
</body>
</html>
